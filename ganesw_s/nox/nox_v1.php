<?php
function my_explode($string, $element)
{
	$delimiter = "/([\s*|,|;|.|!|?|:|\"|@|-]+)/";
	return (preg_split($delimiter, $element));
}
$flag1 = 0;
echo "\033c";
echo "\e[4;34mBIENVENUE SUR LE PROJET NO-X !\e[0m\n";
echo"\e[96m
    ____  ____  ____      ______________   _   ______ _  __
   / __ \/ __ \/ __ \    / / ____/_  __/  / | / / __ \ |/ /
  / /_/ / /_/ / / / /_  / / __/   / /    /  |/ / / / /   / 
 / ____/ _, _/ /_/ / /_/ / /___  / /    / /|  / /_/ /   |  
/_/   /_/ |_|\____/\____/_____/ /_/    /_/ |_/\____/_/|_|
\e[0m";
echo "\n";
echo "Bonjour \e[4;34m\e[5mAgent N˚X\e[0m. Grâce à ce programme, nous allons vous aider à décoder le \e[0;36mWESH\033\e[0m ! (\e[0;33mTu captes ou pas maggle?\e[0m)\n";
echo "Nous avons tout simplifié pour vous; en effet, il suffit de mettre votre fichier avec le \e[0;31mmessage crypté\e[0m et le \e[0;31mdictionnaire fourni\e[0m.\n\n";
echo "\e[4;36mUtilisation:\e[0m 'php nox.php \e[0;35mnom_fichier\e[0m dico'.\n\n";
echo "\e[4;36mIndications:\e[0m\nSi besoin ait, n'hésitez à utiliser l'option \e[0;33m'-h'\e[0m.\n";
echo "Pour quitter le programme, utilisez l'option \e[0;33m'-q'\e[0m.\n\n";
$debut =  microtime(true);
$c = 1;
$p = 0;
$q = 0;
while(isset($argv[$c]))
{
	if ( $argv[$c][0] == '-')
	{
		if(strpos($argv[$c],'h'))
		{
			echo "\nVous avez demandé de l'aide ? Voici comment on utilise le programme dude ! \n";
			echo "Utilisation: 'php nox.php nom_fichier dico'.\n";
		}
		if(strpos($argv[$c],'i'))
		{
			$flag1 = 1;
		}
		if(strpos($argv[$c],'q'))
		{
			echo "See you soon \e[4;37mAgent N˚X\e[0m.\n";
			echo "
###############################################################################
###############################################################################
###########################################**##################################
##########################################*####################################
####################################**#########################################
######################################***######################################
########################################*#######**#############################
################################*#*###*#**#****  **############################
###############################****#****          *#####**#####################
##############################****#***             *####**#####################
##############################** ***              **####*######################
##############################******              **####*######################
######*#####**################**** *              **###**#######*##############
####***###*****###############*** *               *####*####*#** *   *#########
#######*#** *  *##############***                 *####*###*** *     **########
######****     *##############****                *####*###**  *      *########
#####*****      *#############*##*****        *****###**###**         **#######
####*******     *############**##** ****   *******####*###*#*   *      *#######
####****#**  **   ###########******# ****  ** #*#***##*###*#*        ***#######
#####** ***** **  *######*###** ***    **       ** *##*###***##    *#***#######
#####**  ****##*   *#####*###**         *          *#**##**##*#*  *############
######**     #*   ** *##**###**                    ##*###* ****   #***#**######
#####****   **    *** ##***##**         *         *##*####        *    **######
#######**         *** ### **#***        *         *#**####        *     #######
######**          **#####  *#***       **         *#**####*       *    *#######
######*            *###### ******       *        **#*#####*       *    *#######
#######    #*      *########******     *** **    **#*######*    * #*  *########
#######*  *        *########*****      **#**    **#**######*     **  **########
########*  ***    *#*########*****      *       **##*######*  **#*##**#########
######### *#      *#***######*****              **##**#####**  *******#########
#########****    *##***#######****             **##**######***  *****##########
##########*     *##****#######****  **#**********##**######* *     **##########
###########   **##*****######*#***            ***##*#######** **  **###########
################## * **##### **#***    * ********##*#*#####**  *###############
#################******#####   *****************############*** *##############
#################******####*    ##** *       ***#############******############
#################****#######     ##***       **####### *#######******##########
#################*###########     *##**     **#######   *######################
##############################      *#*******#####*#*   #######################
###############################       *#############*  *#######################
################################        *#########*#   *#* ####################
#################################*      ***##*######   #*   ###################
###################################    *########**##   #      #################
####################################    ########***#*  #      *################
#####################################   ########**##           **##############
######################################  ########*##*             ##############
#######*###*########################### *######*#*#*             *#############
######################################## ######***#*             *#############
####################**##################*##########*             *#############
###################################################**            *#############
####*###########*###**#########################*##***            *#############
####*##*#####################################****#***           *##############
#######*##*#################################*  **##**     *    **##############
##########**################################*  ***#*** ****  ****##############
#######*#####################################* ***##***  *******###############
####**#######****#############################* ***##**  *******############***
###*  *** ********############################********* * *****#############***
###*****   **** **############################******#*    ****##############*##
###*****    *******##########################*   *###*     **#############*####
###**  *** ******###***#########**##########** ** *****    *****###############
##** ****#*###***##**##*######***#*####************************######*#########
##**************##**###**####***###*##**#####************* * **################
#***  **************###**###***####*##*######********  **#** *######*#####*####
****  *#* *********####**###**####**#######****  *************########*##**####
***          ******####**##***####**########***  *#     *******#######****#####
               ***#####**##**#####**######****** *#**  *********###############
           *##****####*******#####**#####*****#*****  *******#*################
*##***       *****###********####***#####*****  ***   *****##* ##***###########
    * **         **#*********####***#####***          *****##*** ####*#########
       **          ###**  **********####* *            **  ***  *#### #########
        *                 ***  ****     *           *  *****##*######**########
       * **#                   ***     ###              **********###*#########
     ***    ****            ** **       *              **** *****###* #########
      *   **#**             **         #*##             ** *#******   #########
           ***#                      #######         * *#* ##*        ###*#####
             *         ***   *       ########*  *    **** ###*            *####
             # * * *    ***          ###### *#    ***   *####*       *   *#####
**           *#*  *   ****** **     #######  # ***     *####*           ######*
***      **  **      * ***** **       #####  #******* *####*          *#####**
*******         *    *****#*###**     ###### * *##**#*#*#**         #######**
###*******       *    ***#****#*      #####    ##########**        **######* **
#####* **#*  ***    *#*#**##*####     *####    #########**         ***#####****
\n";
		}
	}
	else
	{
		$message[$q] = $argv[$c];
		$q++;
	}
	$c++;
}
$dico = $message[$q-1];
while($p != $q-1 AND isset($message[$p]))
{
	if(file_exists($message[$p]) AND file_exists($dico) )
	{
		echo "\n\e[32m\e[1m-------------------- RESULTAT : ".$message[$p]." --------------------\e[0m\n";
		$fp = fopen($message[$p],'r');
		if ($fp)
		{
			while (($buf = fgets($fp,4096)) !== false)
			{
				$data = $data . $buf;  
			}
			if (!feof($fp)) 
			{
				echo "Erreur: fgets() a échoué\n";
			}
			fclose($fp);
		}
		$fp = fopen($dico,'r');
		if ($fp)
		{
			while (($buf = fgets($fp,4096)) !== false)
			{
				$data2 = $data2 . $buf;  
			}
			if (!feof($fp)) 
			{
				echo "Erreur: fgets() a échoué\n";
			}
			fclose($fp);
		}
		$Words = my_explode(' ',$data);
		$Words2 = my_explode(' ',$data2);


		$n = 0;
		$m = 0;
		
	/*Debut de l'algorythme de tri 1
	while( isset($Words[$n]) )
	{
		while(isset($Words2[$m]))
		{

			if ($Words[$n] == $Words2[$m])
			{
				echo $Words[$n]."\n";
				$m=0;
				$n++;
			}
			$m++;
		}
		$n++;
		$m=0;
	}
	fin de l'algorythme de tri 1*/

//Debut de l'algorythme de tri 2
		while( isset($Words[$n]))
		{
			if(!$flag1)
			{
				if(($pos = strpos($data2, $Words[$n])) AND ( ($data2[$pos-1] == "\n") AND ($data2[$pos+strlen($Words[$n])] == "\n") ) )
				{
					echo $Words[$n]."\n";
				}
			}
			else
			{
				if(($pos = stripos($data2, $Words[$n])) AND ( ($data2[$pos-1] == "\n") AND ($data2[$pos+strlen($Words[$n])] == "\n") ) )
				{
					echo $Words[$n]."\n";
				}
			}
			$n++;
		}
    //fin de l'algorythme de tri 2
		$fin =  microtime(true);
		$temps = $fin-$debut;
		$n--;
		echo "\n\e[32m\e[1mRecherche effectue en : ".$temps." sec\e[0m\n";
		echo "\e[32m\e[1mLe fichier contient : ".$n." mots\e[0m\n";
	}
	else
	{
		if(!file_exists($message[$p]))
			echo "\n\e[31mERREUR : ".$message[$p]." impossible d'ouvrir le fichier.\e[0m\n";
		if(!file_exists($dico))
			echo "\n\e[31mERREUR : ".$dico." impossible d'ouvrir le dictionnaire.\e[0m\n\n";
	}
$p++;
unset($Words);
unset($Words2);
unset($data);
unset($data2);
unset($temps);
}
?>